<!-- extend from base layout -->
{% extends "base.html" %}

{% block content %}
	<div class="container-fluid">
		<!--Table content-->
		<form action="update_pixels" method="post" name="pixTable">
			{{ form.imgid(value=imgid) }}
			<div class="pixTable" style="width: 100%">
				{% for r in range(16) %}
				<div class="pixRow">
					{% for c in range(16) %}
					<div class="pixCell" id="{{ r }},{{ c }}" style="background-color:#{{ pixels[r][c] }};">
						<input type="hidden" name="{{ r }},{{ c }}" value="row={{ r|string }},col={{ c|string }},h={{ pixels[r][c] }}" />
					</div>
					{% endfor %}
				</div>
				{% endfor %}
			</div>
			<div class="container">
				<span><input type='text' id='myPicker' name='myPicker' /></span>
				<button type="button" class="btn btn-default" id="fill"><span style="color:gray">Set All<span></button>
				<button type="button" class="btn" id="revertbtn" disabled="disabled">Revert</button>
				<button type="submit" class="btn" id="savebtn" disabled="disabled">Save</button>
			</div>
		</form>
	</div>
	<script>
		var mouse_is_down = false;
		var setColor = "white";
        $( "#myPicker" ).spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            hideAfterPaletteSelect: true,
            change: function(color) {
            	$( "#fill" ).css( "background-color", color );
            }
        });
        $( document ).ready(function() {
			$( "li" ).removeClass("active");
			$( "#nav-edit" ).addClass("active");
			$( "#myPicker" ).spectrum( "set", setColor );
        });
        $( ".pixCell" ).mousedown(function() {
            setColor = $("#myPicker").spectrum("get");
            $( this ).css( "background-color", setColor );
            var value = $( this ).find( "input" ).val().split(",");
            var newValue = value[0] + "," + value[1] + ",h=" + setColor.toHex();
            $( this ).find( "input" ).val( newValue );
            $( "#savebtn" ).removeAttr( "disabled" );
            $( "#revertbtn" ).removeAttr( "disabled" );
            $( "#revertbtn" ).addClass( "btn-success" );
            $( "#savebtn" ).addClass( "btn-warning" );
            mouse_is_down = true;
        });
        $( document ).mouseup(function() {
            mouse_is_down = false;
        });
        $( ".pixCell" ).mouseenter(function() {
            if (mouse_is_down) {
				$( this ).css( "background-color", setColor );
				var value = $( this ).find( "input" ).val().split(",");
				var newValue = value[0] + "," + value[1] + ",h=" + setColor.toHex();
				$( this ).find( "input" ).val( newValue );
				$( "#savebtn" ).removeAttr( "disabled" );
				$( "#revertbtn" ).removeAttr( "disabled" );
				$( "#revertbtn" ).addClass( "btn-success" );
				$( "#savebtn" ).addClass( "btn-warning" );
            } 
        });
        $( "#fill" ).click(function() {
        	setColor = $( "#myPicker" ).spectrum("get");
            $( ".pixCell" ).css( "background-color", setColor );
            $( ".pixCell input" ).each(function() {
				var value = $( this ).val().split(",");
				var newValue = value[0] + "," + value[1] + ",h=" + setColor.toHex();
				$( this ).val( newValue );
            });
            $( "#savebtn" ).removeAttr( "disabled" );
        });
        $( "#revertbtn" ).click(function() {
            location.reload();
        });
	</script>
{% endblock %}