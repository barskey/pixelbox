<!-- extend from base layout -->
{% extends "base.html" %}

{% block content %}
	<div class="container-fluid">
		<!--Table content-->
		<form action="update_pixels" method="post" name="pixTable">
			{{ form.imgid(value=imgid) }}
			<div class="container">
				<div class="input-group">
					<div class="input-group-addon">Name</div>
					<input type="text" class="form-control" id="imagename" name="imagename" value="{{ imgname }}">
					<div class="input-group-addon">Anim? <input type="checkbox" name="animated" data-size="mini" data-on-text="Yes" data-off-text="No" data-on-color="success" {% if animated %}checked{% endif %}></div>
				</div><!-- /input-group -->
			</div><!-- /container -->
			<div class="pixTable" style="width: 100%">
				{% for r in range(16) %}
				<div class="pixRow">
					{% for c in range(16) %}
					<div class="pixCell" id="{{ r }},{{ c }}" style="background-color:#{{ pixels[r][c] }};">
						<input type="hidden" name="pix_r{{ r }}_c{{ c }}" value="row={{ r|string }},col={{ c|string }},h={{ pixels[r][c] }}" />
					</div><!-- /pixCell -->
					{% endfor %}
				</div><!-- /pixRow -->
				{% endfor %}
			</div><!-- /pixTable -->
			<div class="collapse" id="framecontrols">
				<div class="well well-sm">
					<div class="btn-toolbar" role="toolbar">
						<div class="btn-group text-left" role="group">
							<button type="button" class="btn" id="frames" disabled="disabled">1 of 10</button>
						</div><!-- /btn-group -->
						<div class="btn-group text-center" role="group">
							<button type="button" class="btn btn-default" id="firstframe" name="firstframe"><span class="glyphicon glyphicon-fast-backward"></span></button>
							<button type="button" class="btn btn-default" id="prevframe" name="prevframe"><span class="glyphicon glyphicon-backward"></span></button>
							<button type="button" class="btn btn-default" id="play" name="play"><span class="glyphicon glyphicon-play"></span></button>
							<button type="button" class="btn btn-default" id="nextframe" name="nextframe"><span class="glyphicon glyphicon-forward"></span></button>
							<button type="button" class="btn btn-default" id="lastframe" name="lastframe"><span class="glyphicon glyphicon-fast-forward"></span></button>
						</div><!-- /btn-group -->
						<div class="btn-group text-right" role="group">
							<button type="button" class="btn btn-default" id="addframe" name="addframe"><span class="glyphicon glyphicon-plus"></span></button>
							<button type="button" class="btn btn-default" id="delframe" name="delframe"><span class="glyphicon glyphicon-minus"></span></button>
						</div><!-- /btn-group -->
					</div><!-- /btn-toolbar -->
				</div>
			</div><!-- /collapse div -->
			<div class="well well-sm">
				<span><input type='text' id='myPicker' name='myPicker' /></span>
				<span class="pull-right">
					<button type="button" class="btn btn-default" id="fill"><span style="color:gray">Set All<span></button>
					<button type="button" class="btn" id="revertbtn" disabled="disabled">Revert</button>
					<button type="submit" class="btn" id="savebtn" disabled="disabled">Save</button>
				</span>
			</div><!-- /well -->
		</form>
	</div>
	<script>
		var mouse_is_down = false;
		$setColor = "ffffff";
		$( "input[name='animated']").bootstrapSwitch();
        $( "#myPicker" ).spectrum({
            showPaletteOnly: true,
            togglePaletteOnly: true,
            hideAfterPaletteSelect: true,
            change: function(color) {
            	$( "#fill" ).css( "background-color", color );
            }
        });
        $( "input[name='animated']").on("switchChange.bootstrapSwitch", function(event, state) {
        	$( ".collapse" ).collapse("toggle");
            $( "#savebtn" ).removeAttr( "disabled" );
			$( "#revertbtn" ).removeAttr( "disabled" );
			$( "#revertbtn" ).addClass( "btn-success" );
			$( "#savebtn" ).addClass( "btn-warning" );
        });
        $( document ).ready(function() {
			$( "li" ).removeClass("active");
			$( "#nav-edit" ).addClass("active");
			$( "#myPicker" ).spectrum( "set", $setColor );
			if ($( "input[name='animated']").bootstrapSwitch("state")) {
				$( ".collapse" ).collapse("toggle");
			}
        });
        $( ".pixCell" ).mousedown(function() {
            $setColor = $("#myPicker").spectrum("get");
            $( this ).css( "background-color", $setColor );
            var value = $( this ).find( "input" ).val().split(",");
            var newValue = value[0] + "," + value[1] + ",h=" + $setColor.toHex();
            $( this ).find( "input" ).val( newValue );
            $( "#savebtn" ).removeAttr( "disabled" );
            $( "#revertbtn" ).removeAttr( "disabled" );
            $( "#revertbtn" ).addClass( "btn-success" );
            $( "#savebtn" ).addClass( "btn-warning" );
            mouse_is_down = true;
        });
        $( document ).mouseup(function() {
            mouse_is_down = false;
        });
        $( ".pixCell" ).mouseenter(function() {
            if (mouse_is_down) {
				$( this ).css( "background-color", $setColor );
				var value = $( this ).find( "input" ).val().split(",");
				var newValue = value[0] + "," + value[1] + ",h=" + $setColor.toHex();
				$( this ).find( "input" ).val( newValue );
				$( "#savebtn" ).removeAttr( "disabled" );
				$( "#revertbtn" ).removeAttr( "disabled" );
				$( "#revertbtn" ).addClass( "btn-success" );
				$( "#savebtn" ).addClass( "btn-warning" );
            } 
        });
        $( "#fill" ).click(function() {
        	$setColor = $( "#myPicker" ).spectrum("get");
            $( ".pixCell" ).css( "background-color", $setColor );
            $( ".pixCell input" ).each(function() {
				var value = $( this ).val().split(",");
				var newValue = value[0] + "," + value[1] + ",h=" + $setColor.toHex();
				$( this ).val( newValue );
            });
            $( "#savebtn" ).removeAttr( "disabled" );
			$( "#revertbtn" ).removeAttr( "disabled" );
			$( "#revertbtn" ).addClass( "btn-success" );
			$( "#savebtn" ).addClass( "btn-warning" );
        });
        $( "#revertbtn" ).click(function() {
            location.reload();
        });
	</script>
{% endblock %}